---
title: "2020-02-10: Epidemic Mitigation Time Forecast (Covid-19)"
date: 2020-02-10
slug: predict-2020-02-10
---

```{r include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE, error = FALSE, collapse = TRUE, out.width = "100%")
Sys.setlocale('LC_CTYPE', 'Chinese')
```

```{r}
require(ncovr)
ncovChina <- get_ncov('china') 
ncovChina <- ncovChina[ncovChina[, "日期"] <= as.Date('2020-02-10'), ]
```

## Time trends and model predictions of confirmed cases across the country

```{r}
predict_date(province = "中国",  ncov = ncovChina)
pre <- predict_date(province = "中国",  ncov = ncovChina, ifplot = FALSE)
```

Our model shows that the national epidemic situation will ease on `r pre$enddate` (the number of confirmed cases will not increase significantly).

On `r pre$tomorrow` there will be `r format(round(pre$tomorrowNew), scientific = FALSE)` new confirmed cases and in total `r format(round(pre$tomorrowcount), scientific = FALSE)` confirmed cases.

## National Epidemic Time Series

<small>

```{r}
ncovChina <- ncovChina[rev(order(ncovChina[, 1])), ]

x <- ncovChina[, 1:9]
names(x) <- c('Date', 'Confirmed', 'Suspected', 'Severe', 'Dead', 'Cured', 'Conf.+Susp.', 'Incr. in Conf.+ Susp.', 'Under Obs.')
flextable::flextable(x) #, col_keys = )
```

</small>


```{r}
ncov <- get_ncov()
ncov$area$date <- as.Date(ncovr:::conv_time(ncov$area$updateTime))
ncov$area <- ncov$area[ncov$area$date < as.Date('2020-02-10'), ]
df_predict <- t(sapply(unique(ncov$area$provinceShortName[ncov$area$country == '中国']), function(x) predict_date(province = x, ncov = ncov, ifplot = FALSE)))


df_predict <- as.data.frame(df_predict)
df_predict$area <- unlist(df_predict$area)
df_predict <- df_predict[order(-as.numeric(df_predict$tomorrowNew)), ]

dic_city <-  readr::read_csv(system.file('china_city_list.csv', package = 'ncovr'))
df_predict$area_en <- unlist(dic_city[match(df_predict$area, dic_city$Province), 'Province_EN'])

tomorrow <- df_predict$tomorrow[1]
```

```{r, results='asis'}
cat("## 2020-02-10 Epidemic forecast by province")
```

```{r}
y <- df_predict[!is.na(df_predict$enddate), c(6, 1, 2, 5, 4)]

names(y) <- c("[Area]", '[Area_cn]', "[Epidemic Mitigation Time]", paste0("[", tomorrow[[1]], " Prdctd daily incrs conf.]"), paste0("[", tomorrow[[1]], " Prdctd conf. in total]"))
flextable::flextable(y)
```

```{r, results='asis'}
Prov <- c("湖北", unique(ncov$area$provinceShortName[ncov$area$country == '中国' & !ncov$area$provinceShortName %in% c('湖北', '待明确地区')]))

for(x in Prov) {
  cat(x, ":  \n")
  predict_date(province = x, ncov = ncov, ifplot = TRUE, ifchinese = FALSE)
  cat("  \n")
}
```
